# template-uv-mcp-server

A reusable template for building MCP (Model Context Protocol) servers using the Python SDK with `uv` as the dependency manager and runtime tool.

## Overview

This template provides a starting point for creating custom MCP servers that can be used with Claude Desktop and other MCP clients. It follows the official [MCP Python SDK](https://github.com/modelcontextprotocol/python-sdk) best practices and uses [uv](https://docs.astral.sh/uv/) for fast, reliable dependency management.

## Quick Start

### Prerequisites

- Python 3.11+
- [uv](https://docs.astral.sh/uv/getting-started/installation/) installed

### Installation

1. Clone or use this template:
```bash
git clone https://github.com/ezemriv/template-uv-mcp-server.git
cd template-uv-mcp-server
```

2. Install dependencies:
```bash
uv sync
```

3. Test the server:
```bash
uv run template-uv-mcp-server
# or
uv run python -m template_uv_mcp_server
```

## Project Structure

```
template-uv-mcp-server/
├── .gitignore                          # Git ignore rules
├── .python-version                     # Python version specification (3.11)
├── LICENSE                             # License file
├── README.md                           # This file
├── PLAN.md                             # Implementation plan
├── pyproject.toml                      # Project configuration & dependencies
├── uv.lock                             # Lock file (generated by uv)
└── src/
    └── template_uv_mcp_server/
        ├── __init__.py                 # Package initialization
        ├── __main__.py                 # Entry point for `python -m`
        └── server.py                   # Main MCP server implementation
```

## Core Files

### `pyproject.toml`
Project configuration following PEP 621 standards. Defines:
- Project metadata (name, version, description)
- Dependencies (mcp with CLI support)
- Console script entry point
- Build system configuration

### `src/template_uv_mcp_server/server.py`
Main server implementation using FastMCP. Includes example implementations of:
- **Tool**: `hello()` - A simple tool that greets a user
- **Resource**: `get_info()` - A resource endpoint providing template information
- **Prompt**: `greeting_prompt()` - A reusable prompt template

### `src/template_uv_mcp_server/__init__.py`
Package initialization that exports the `main` function and version.

### `src/template_uv_mcp_server/__main__.py`
Enables running the server as a module: `python -m template_uv_mcp_server`

## Usage

### Running Locally

```bash
# Using uv
uv run template-uv-mcp-server

# Or using Python directly
uv run python -m template_uv_mcp_server
```

### Testing with MCP Dev Tools

```bash
# Start the development server with MCP Inspector
uv run mcp dev src/template_uv_mcp_server/server.py
```

## Configuration for Claude Desktop

### Option 1: Using `uv run` (Recommended)

Edit your Claude Desktop configuration file and add:

**macOS**: `~/Library/Application Support/Claude/claude_desktop_config.json`
**Windows**: `%APPDATA%\Claude\claude_desktop_config.json`
**Linux**: `~/.config/Claude/claude_desktop_config.json`

```json
{
  "mcpServers": {
    "template-server": {
      "command": "uv",
      "args": [
        "--directory",
        "/path/to/template-uv-mcp-server",
        "run",
        "template-uv-mcp-server"
      ]
    }
  }
}
```

Replace `/path/to/template-uv-mcp-server` with the actual path to your project.

### Option 2: Using the MCP CLI

```bash
uv run mcp install src/template_uv_mcp_server/server.py --name "Template Server"
```

This will automatically update your Claude Desktop configuration.

## Customization

### Adding New Tools

Tools are functions decorated with `@mcp.tool()`. They should have:
- Clear docstrings (used as tool descriptions for Claude)
- Type hints for parameters and return values
- Optional `Context` parameter for advanced features

```python
@mcp.tool()
def my_tool(param1: str, param2: int = 10) -> dict:
    """Description of what this tool does."""
    return {"result": f"{param1} processed with {param2}"}
```

### Adding New Resources

Resources are data endpoints decorated with `@mcp.resource()`. They can use URI templates for dynamic resources:

```python
@mcp.resource("myapp://document/{id}")
def get_document(id: str) -> str:
    """Retrieve a document by ID."""
    return f"Content of document {id}"
```

### Adding New Prompts

Prompts are reusable templates decorated with `@mcp.prompt()`:

```python
@mcp.prompt()
def code_review_prompt(code: str) -> str:
    """Generate a code review prompt."""
    return f"Please review this code:\n\n{code}"
```

### Adding Dependencies

```bash
# Add a regular dependency
uv add requests

# Add a dev dependency
uv add --dev pytest
```

## Development Workflow

### Initial Setup
```bash
uv sync --dev
```

### Running Tests
```bash
uv run pytest
```

### Type Checking
```bash
uv run mypy src/
```

### Linting
```bash
uv run ruff check src/
```

### Code Formatting
```bash
uv run ruff format src/
```

## Advanced Features

### Using Context for Logging

```python
from mcp.server.fastmcp import Context, FastMCP

@mcp.tool()
async def advanced_tool(param: str, ctx: Context) -> str:
    """Tool that uses logging context."""
    await ctx.info(f"Processing parameter: {param}")
    try:
        result = do_something(param)
        return result
    except Exception as e:
        await ctx.error(f"Error occurred: {e}")
        raise
```

### Structured Output with Pydantic

```python
from pydantic import BaseModel

class AnalysisResult(BaseModel):
    status: str
    score: float
    details: str

@mcp.tool()
def analyze_data(data: str) -> AnalysisResult:
    """Analyze data and return structured result."""
    return AnalysisResult(
        status="success",
        score=0.95,
        details="Analysis complete"
    )
```

### Lifespan Management

For complex servers needing setup/teardown:

```python
from contextlib import asynccontextmanager
from collections.abc import AsyncIterator

@asynccontextmanager
async def app_lifespan(server: FastMCP) -> AsyncIterator[dict]:
    # Setup phase
    db = await Database.connect()
    cache = {}
    
    try:
        yield {"db": db, "cache": cache}
    finally:
        # Cleanup phase
        await db.disconnect()

mcp = FastMCP("My App", lifespan=app_lifespan)
```

## Troubleshooting

### Python Version Issues
This template requires Python 3.11+. Check your version:
```bash
python --version
```

### uv Not Found
Install uv with:
```bash
curl -LsSf https://astral.sh/uv/install.sh | sh
```

### Import Errors When Running
Ensure dependencies are installed:
```bash
uv sync
```

### Claude Desktop Not Finding Server
Verify the path in `claude_desktop_config.json` is correct and the server starts without errors:
```bash
uv run template-uv-mcp-server
```

## Resources

- [MCP Python SDK Documentation](https://github.com/modelcontextprotocol/python-sdk)
- [MCP Specification](https://modelcontextprotocol.io/specification/latest)
- [Claude Desktop Setup Guide](https://modelcontextprotocol.io/clients/claude-desktop)
- [uv Documentation](https://docs.astral.sh/uv/)
- [FastMCP Examples](https://github.com/modelcontextprotocol/python-sdk/tree/main/examples)

## License

This template is licensed under the MIT License. See the LICENSE file for details.

## Contributing

Contributions are welcome! Please feel free to submit pull requests or open issues for bugs and feature requests.
